<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="/css/team/team-rank.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link
		href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&family=Roboto:ital,wght@0,100;0,400;0,900;1,300;1,700;1,900&display=swap"
		rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

</head>

<body>
	<div th:replace="/page/fragment/header.html :: f-head"></div>
	<div id="main">
		<h3>íŒ€ ë­í¬</h3><br>
		<div class="content-container">
			<select id="s" name="s">
				<option value="">ì¢…ëª©</option>
				<option value="ì•¼êµ¬">ì•¼êµ¬</option>
				<option value="ì¶•êµ¬">ì¶•êµ¬</option>
				<option value="ë†êµ¬">ë†êµ¬</option>
			</select>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<select id="s2" name="s2">
				<option value="">ì§€ì—­</option>
			</select>
			<script src="/js/mock/region.js"></script>
			<script type="module">
				// ì‹œ/ë„ ì˜µì…˜ ì¶”ê°€
				const sidoSelect = document.querySelector('#s2');
				const sigunguSelect = document.querySelector('#sigungu');

				for (let key in address) {
					let option = document.createElement('option');
					option.text = key;
					sidoSelect.add(option);
				}

				function makeSigungu() {
					let sido = sidoSelect.value;
					sigunguSelect.innerHTML = '<option>ì‹œ/êµ°/êµ¬</option>';

					if (sido !== 'ì‹œ/ë„') {
						let siGunGu = address[sido];
						for (let j = 0; j < siGunGu.length; j++) {
							let option = document.createElement('option');
							option.text = siGunGu[j];
							sigunguSelect.add(option);
						}
					}
				}
			</script>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

			<input type="range" min="0" max="1000" value="0" class="custom-range w-50 p-3" id="myRange" step="100">
			<p class="form-label">íŒ€ ì ìˆ˜:<span id="value"></span></p>

			<button type="button" id="search-button" onclick="performSearch()" class="btn btn-dark">ê²€ìƒ‰</button>
		</div>


		<table id="teamTable">

			<thead>
				<tr>
					<th>ìˆœìœ„</th>
					<th>ì¢…ëª©</th>
					<th>íŒ€</th>
					<th>ì§€ì—­</th>
					<th>í¬ì¸íŠ¸</th>
				</tr>
			</thead>

			<tbody id="tBody">

			</tbody>
		</table>
		<div id="rankpageDiv"></div>

	</div>
	<script>


		var slider = document.getElementById("myRange");
		var output = document.getElementById("value");
		output.innerHTML = slider.value;

		slider.oninput = function () {
			output.innerHTML = this.value;
		}

		function addRow(tableBody, rank, taType, taName, taBoundarySido, taPoint, taNum) {
			const row = document.createElement('tr');

			// ìˆœìœ„ì— ë”°ë¼ ë©”ë‹¬ ì•„ì´ì½˜ìœ¼ë¡œ ë³€ê²½
			let medalIcon = '';
			if (rank === 1) {
				medalIcon = 'ğŸ¥‡';
			} else if (rank === 2) {
				medalIcon = 'ğŸ¥ˆ';
			} else if (rank === 3) {
				medalIcon = 'ğŸ¥‰';
			}

			const rankDisplay = rank <= 3 ? medalIcon : rank;

			row.innerHTML = `
        <td>${rankDisplay}</td>
        <td>${taType}</td>
        <td><a href="/page/team/record?taNum=${taNum}">${taName}</a></td>
        <td>${taBoundarySido}</td>
        <td>${taPoint}</td>
    `;

			tableBody.appendChild(row);
		}

		async function performSearch() {
			const sport = document.getElementById("s").value;
			console.log('ì„ íƒëœ ì¢…ëª©:', sport);
			const area = document.getElementById("s2").value;
			const skill = parseInt(document.getElementById("myRange").value);

			console.log('Sport:', sport);
			console.log('Area:', area);
			console.log('Skill:', skill);


			const rankRes = await fetch('/team-infos'); 
			const teamData = await rankRes.json();

			console.log('teamData:', teamData);
			const upperBound = skill + 100;

			// ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸ ì¶”ê°€
			console.log('Before filtering:', teamData);

			const filteredData = teamData.filter((row) => {
				const isSportMatch = sport === "" || row.taType === sport;
				const isAreaMatch = area === "" || row.taBoundarySido === area;
				const isSkillMatch = skill === 0 || (row.taPoint >= skill && row.taPoint <= upperBound);

				const result = isSportMatch && isAreaMatch && isSkillMatch;


				console.log('Row:', row, 'Result:', result);

				return result;
			});



			console.log('After filtering:', filteredData);

			const tableBody = document.getElementById("tBody");
			tableBody.innerHTML = '';
			let i = 1;
			filteredData.forEach((row) => {
				addRow(tableBody, i, row.taType, row.taName, row.taBoundarySido, row.taPoint, row.taNum);
				i++;
			});
			console.log('Checking values:', 'Sport:', sport, 'Area:', area, 'Skill:', skill);
		}


		window.addEventListener('load', async function () {

			const rankRes = await fetch('/team-infos');
			teamData = await rankRes.json();

			console.log('teamData:', teamData);

			let html = '';
			let i = 1;
			for (const row of teamData) {
				html += '<tr>';
				if (i === 1) {
					html += `<td>ğŸ¥‡</td>`;
				} else if (i === 2) {
					html += `<td>ğŸ¥ˆ</td>`;
				} else if (i === 3) {
					html += `<td>ğŸ¥‰</td>`;
				} else {
					html += `<td>${i}</td>`
				}
				html += `<td>${row.taType}</a></td>`;
				html += `<td><a href="/page/match/match-record?taNum=${row.taNum}">${row.taName}</td>`;
				html += `<td>${row.taBoundarySido}</td>`;
				html += `<td>${row.taPoint}</td>`;
				html += '</tr>';
				i++;
			}
			document.querySelector('#tBody').innerHTML = html;
		});

		window.addEventListener('scroll', () => {
			if (window.scrollY > 50) {
				header.style.opacity = '0'; // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì— ë”°ë¼ ë‚´ë¹„ê²Œì´ì…˜ ë°” ìˆ¨ê¹€
				header.style.transform = 'translateY(-100%)';
			} else {
				header.style.opacity = '1'; // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì— ë”°ë¼ ë‚´ë¹„ê²Œì´ì…˜ ë°” í‘œì‹œ
				header.style.transform = 'translateY(0)';
			}
		});
	</script>

</body>

</html>